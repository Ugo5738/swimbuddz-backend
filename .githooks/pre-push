#!/bin/sh

# Run Ruff formatting and lint checks before pushing.
# Exits non-zero to block the push if Ruff is not available or checks fail.

echo "Running Ruff format check..."
if ! command -v ruff >/dev/null 2>&1; then
    echo "ruff not found in PATH. Activate the project's venv or install dev deps (pyproject.dev)." >&2
    exit 1
fi

ruff format --check .
FORMAT_STATUS=$?

echo "Running Ruff lint check..."
ruff check .
LINT_STATUS=$?

if [ $FORMAT_STATUS -ne 0 ] || [ $LINT_STATUS -ne 0 ]; then
    echo "Pre-push checks failed (format=$FORMAT_STATUS, lint=$LINT_STATUS)." >&2
    exit 1
fi

echo "Pre-push Ruff checks passed."
exit 0
